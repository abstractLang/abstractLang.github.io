# Bytecode

# Bit Organization table

<table>
    <thead>
        <tr>
            <td colSpan={8}><b>Bits</b></td>
            <td><b>Bytecode</b></td>
            <td><b>Instruction</b></td>
            <td colSpan={2}><b>Arguments</b></td>
        </tr>
    </thead>

    <tbody>
        {/* ===== nop, invalid, Stack ===== */}
        <tr>
            <td rowSpan={6}>0</td>
            <td rowSpan={6}>0</td>
            <td rowSpan={6}>0</td>
        </tr>
        
        <tr> <td>0</td><td>0</td><td>0</td><td>0</td><td>0</td> <td>0x00</td> <td>nop</td>     <td colSpan={2}></td> </tr>
        <tr> <td>0</td><td>0</td><td>0</td><td>0</td><td>1</td> <td>0x01</td> <td>invalid</td> <td colSpan={2}></td> </tr>
        <tr> <td>0</td><td>0</td><td>0</td><td>1</td><td>0</td> <td>0x02</td> <td>pop</td>     <td colSpan={2}></td> </tr>
        <tr> <td>0</td><td>0</td><td>0</td><td>1</td><td>1</td> <td>0x03</td> <td>dup</td>     <td colSpan={2}></td> </tr>
        <tr> <td>0</td><td>0</td><td>1</td><td>0</td><td>0</td> <td>0x04</td> <td>swap</td>    <td colSpan={2}></td> </tr>
        

        {/* ===== Arithmetic ===== */}
        <tr>
            <td rowSpan={18}>0</td>
            <td rowSpan={18}>0</td>
            <td rowSpan={18}>1</td>
        </tr>
        
        <tr> <td>0</td><td>0</td><td>0</td><td>0</td><td>0</td> <td>0x20</td> <td>add</td>     <td colSpan={2}></td> </tr>
        <tr> <td>0</td><td>0</td><td>0</td><td>0</td><td>1</td> <td>0x21</td> <td>sub</td>     <td colSpan={2}></td> </tr>
        <tr> <td>0</td><td>0</td><td>0</td><td>1</td><td>0</td> <td>0x22</td> <td>mul.s</td>   <td colSpan={2}></td> </tr>
        <tr> <td>0</td><td>0</td><td>0</td><td>1</td><td>1</td> <td>0x23</td> <td>mul.u</td>   <td colSpan={2}></td> </tr>
        <tr> <td>0</td><td>0</td><td>1</td><td>0</td><td>0</td> <td>0x24</td> <td>div.s</td>   <td colSpan={2}></td> </tr>
        <tr> <td>0</td><td>0</td><td>1</td><td>0</td><td>1</td> <td>0x25</td> <td>div.u</td>   <td colSpan={2}></td> </tr>
        <tr> <td>0</td><td>0</td><td>1</td><td>1</td><td>0</td> <td>0x26</td> <td>rem.s</td>   <td colSpan={2}></td> </tr>
        <tr> <td>0</td><td>0</td><td>1</td><td>1</td><td>1</td> <td>0x27</td> <td>rem.u</td>   <td colSpan={2}></td> </tr>
        <tr> <td>0</td><td>1</td><td>0</td><td>0</td><td>0</td> <td>0x28</td> <td>neg</td>     <td colSpan={2}></td> </tr>

        {/* ===== Bitwise ===== */}
        <tr> <td>0</td><td>1</td><td>0</td><td>0</td><td>1</td> <td>0x29</td> <td>not</td>     <td colSpan={2}></td> </tr>
        <tr> <td>0</td><td>1</td><td>0</td><td>1</td><td>0</td> <td>0x2A</td> <td>and</td>     <td colSpan={2}></td> </tr>
        <tr> <td>0</td><td>1</td><td>0</td><td>1</td><td>1</td> <td>0x2B</td> <td>or</td>      <td colSpan={2}></td> </tr>
        <tr> <td>0</td><td>1</td><td>1</td><td>0</td><td>0</td> <td>0x2C</td> <td>xor</td>     <td colSpan={2}></td> </tr>

        {/* ===== Shift ===== */}
        <tr> <td>0</td><td>1</td><td>1</td><td>0</td><td>0</td> <td>0x2D</td> <td>shr</td>     <td colSpan={2}></td> </tr>
        <tr> <td>0</td><td>1</td><td>1</td><td>0</td><td>1</td> <td>0x2E</td> <td>shl</td>     <td colSpan={2}></td> </tr>
        <tr> <td>0</td><td>1</td><td>1</td><td>1</td><td>0</td> <td>0x2F</td> <td>ror</td>     <td colSpan={2}></td> </tr>
        <tr> <td>0</td><td>1</td><td>1</td><td>1</td><td>1</td> <td>0x30</td> <td>rol</td>     <td colSpan={2}></td> </tr>

        {/* ===== Blocks ===== */}
        <tr>
            <td rowSpan={7}>0</td>
            <td rowSpan={7}>1</td>
            <td rowSpan={7}>0</td>
        </tr>

        <tr> <td>0</td><td>0</td><td>0</td><td>0</td><td>0</td> <td>0x40</td> <td>block</td>   <td colSpan={2}></td> </tr>
        <tr> <td>0</td><td>0</td><td>0</td><td>0</td><td>1</td> <td>0x41</td> <td>loop</td>    <td colSpan={2}></td> </tr>
        <tr> <td>0</td><td>0</td><td>0</td><td>1</td><td>0</td> <td>0x42</td> <td>if</td>      <td colSpan={2}></td> </tr>
        <tr> <td>0</td><td>0</td><td>0</td><td>1</td><td>1</td> <td>0x43</td> <td>else</td>    <td colSpan={2}></td> </tr>
        <tr> <td>0</td><td>0</td><td>1</td><td>0</td><td>0</td> <td>0x44</td> <td>switch</td>  <td>imm8</td> <td></td> </tr>
        <tr> <td>0</td><td>0</td><td>1</td><td>0</td><td>1</td> <td>0x45</td> <td>end</td>     <td colSpan={2}></td> </tr>

        {/* ===== scalar load ===== */}
        <tr>
            <td rowSpan={26}>0</td>
            <td rowSpan={26}>1</td>
            <td rowSpan={26}>1</td>
        </tr>

        <tr> <td>0</td><td>0</td><td>0</td><td>0</td><td>0</td> <td>0x60</td> <td>ld.const.i1 0</td>     <td colSpan={2}></td> </tr>
        <tr> <td>0</td><td>0</td><td>0</td><td>0</td><td>1</td> <td>0x61</td> <td>ld.const.i1 1</td>     <td colSpan={2}></td> </tr>
        <tr> <td>0</td><td>0</td><td>0</td><td>1</td><td>0</td> <td>0x62</td> <td>ld.const.i8</td>     <td>imm8</td> <td></td> </tr>
        <tr> <td>0</td><td>0</td><td>0</td><td>1</td><td>1</td> <td>0x63</td> <td>ld.const.i16</td>    <td>imm16</td> <td></td> </tr>
        <tr> <td>0</td><td>0</td><td>1</td><td>0</td><td>0</td> <td>0x64</td> <td>ld.const.i32</td>    <td>imm32</td> <td></td> </tr>
        <tr> <td>0</td><td>0</td><td>1</td><td>0</td><td>1</td> <td>0x65</td> <td>ld.const.i64</td>    <td>imm64</td> <td></td> </tr>
        <tr> <td>0</td><td>0</td><td>1</td><td>1</td><td>0</td> <td>0x66</td> <td>ld.const.i128</td>   <td>imm128</td> <td></td> </tr>
        <tr> <td>0</td><td>0</td><td>1</td><td>1</td><td>1</td> <td>0x67</td> <td>ld.const.iptr</td>   <td>immPtr</td> <td></td> </tr>
        <tr> <td>0</td><td>1</td><td>0</td><td>0</td><td>0</td> <td>0x68</td> <td>ld.const.i[n]</td>   <td>imm8</td> <td>imm[n]</td> </tr>
        <tr> <td>0</td><td>1</td><td>0</td><td>0</td><td>1</td> <td>0x69</td> <td>ld.const.null</td>   <td colSpan={2}></td> </tr>

        <tr> <td>0</td><td>1</td><td>0</td><td>1</td><td>0</td> <td>0x6A</td> <td>ld.new.slice</td>    <td>type</td> <td>imm32</td> </tr>
        <tr> <td>0</td><td>1</td><td>0</td><td>1</td><td>1</td> <td>0x6B</td> <td>ld.new.type</td>     <td>type</td> <td></td> </tr>

        <tr> <td>0</td><td>1</td><td>1</td><td>0</td><td>0</td> <td>0x6C</td> <td>ld.local</td>        <td>imm8</td> <td></td> </tr>
        <tr> <td>0</td><td>1</td><td>1</td><td>0</td><td>1</td> <td>0x6D</td> <td>ld.local</td>        <td>imm16</td> <td></td> </tr>
        <tr> <td>0</td><td>1</td><td>1</td><td>0</td><td>0</td> <td>0x6E</td> <td>ld.local.ref</td>    <td>imm8</td> <td></td> </tr>
        <tr> <td>0</td><td>1</td><td>1</td><td>0</td><td>1</td> <td>0x6F</td> <td>ld.local.ref</td>    <td>imm16</td> <td></td> </tr>
        <tr> <td>0</td><td>1</td><td>1</td><td>1</td><td>0</td> <td>0x70</td> <td>ld.arg.0</td>        <td colSpan={2}></td> </tr>
        <tr> <td>0</td><td>1</td><td>1</td><td>1</td><td>1</td> <td>0x71</td> <td>ld.arg.1</td>        <td colSpan={2}></td> </tr>
        <tr> <td>1</td><td>0</td><td>0</td><td>0</td><td>0</td> <td>0x72</td> <td>ld.arg.2</td>        <td colSpan={2}></td> </tr>
        <tr> <td>1</td><td>0</td><td>0</td><td>0</td><td>1</td> <td>0x73</td> <td>ld.arg.3</td>        <td colSpan={2}></td> </tr>

        <tr> <td>1</td><td>0</td><td>0</td><td>0</td><td>1</td> <td>0x74</td> <td>ld.field</td>        <td colSpan={2}></td> </tr>
        <tr> <td>1</td><td>0</td><td>0</td><td>0</td><td>1</td> <td>0x75</td> <td>ld.field.ref</td>    <td colSpan={2}></td> </tr>
        <tr> <td>1</td><td>0</td><td>0</td><td>0</td><td>1</td> <td>0x76</td> <td>ld.func.ref</td>     <td colSpan={2}></td> </tr>
        <tr> <td>1</td><td>0</td><td>0</td><td>0</td><td>1</td> <td>0x77</td> <td>ld.type.ref</td>     <td colSpan={2}></td> </tr>

        <tr> <td>1</td><td>0</td><td>0</td><td>1</td><td>0</td> <td>0x78</td> <td>ld.index</td>        <td colSpan={2}></td> </tr>

        {/* ===== scalar store ===== */}
        <tr>
            <td rowSpan={5}>1</td>
            <td rowSpan={5}>0</td>
            <td rowSpan={5}>0</td>
        </tr>

        <tr> <td>0</td><td>0</td><td>0</td><td>0</td><td>0</td> <td>0x80</td> <td>st.local</td>        <td>imm8</td> <td></td> </tr>
        <tr> <td>0</td><td>0</td><td>0</td><td>0</td><td>1</td> <td>0x81</td> <td>st.local</td>        <td>imm16</td> <td></td> </tr>
        <tr> <td>0</td><td>0</td><td>0</td><td>1</td><td>0</td> <td>0x82</td> <td>st.field</td>        <td>Field</td> <td></td> </tr>
        <tr> <td>0</td><td>0</td><td>0</td><td>1</td><td>1</td> <td>0x83</td> <td>st.index</td>        <td colSpan={2}></td> </tr>

        {/* ===== type conversion ===== */}
        <tr>
            <td rowSpan={4}>1</td>
            <td rowSpan={4}>0</td>
            <td rowSpan={4}>1</td>
        </tr>

        <tr> <td>0</td><td>0</td><td>0</td><td>0</td><td>0</td> <td>0xA0</td> <td>extend</td>     <td>imm8</td> <td></td> </tr>
        <tr> <td>0</td><td>0</td><td>0</td><td>0</td><td>1</td> <td>0xA1</td> <td>trunc</td>      <td>imm8</td> <td></td> </tr>
        <tr> <td>0</td><td>0</td><td>0</td><td>1</td><td>0</td> <td>0xA2</td> <td>bitcast</td>    <td>imm8</td> <td></td> </tr>

        {/* ===== Memop ===== */}
        <tr>
            <td rowSpan={4}>1</td>
            <td rowSpan={4}>1</td>
            <td rowSpan={4}>0</td>
        </tr>

        <tr> <td>0</td><td>0</td><td>0</td><td>0</td><td>0</td> <td>0xC0</td> <td>mem.copy</td>   <td colSpan={2}></td> </tr>
        <tr> <td>0</td><td>0</td><td>0</td><td>0</td><td>1</td> <td>0xC1</td> <td>mem.fill</td>   <td colSpan={2}></td> </tr>
        <tr> <td>0</td><td>0</td><td>0</td><td>1</td><td>0</td> <td>0xC2</td> <td>mem.eq</td>   <td colSpan={2}></td> </tr>
        
        {/* ===== Flag / Source data ===== */}
        <tr>
            <td rowSpan={6}>1</td>
            <td rowSpan={6}>1</td>
            <td rowSpan={6}>1</td>
        </tr>

        <tr> <td>0</td><td>0</td><td>0</td><td>0</td><td>0</td> <td>0xE0</td> <td>allow.ovf.</td>          <td colSpan={2}></td> </tr>
        <tr> <td>0</td><td>0</td><td>0</td><td>0</td><td>1</td> <td>0xE1</td> <td>allow.nil.</td>          <td colSpan={2}></td> </tr>
        <tr> <td>0</td><td>0</td><td>0</td><td>1</td><td>0</td> <td>0xE2</td> <td>src.offset.global</td>   <td>imm32</td> <td></td> </tr>
        <tr> <td>0</td><td>0</td><td>0</td><td>1</td><td>1</td> <td>0xE3</td> <td>src.offset.rel</td>      <td>imm8</td> <td></td> </tr>
        <tr> <td>0</td><td>0</td><td>1</td><td>0</td><td>0</td> <td>0xE4</td> <td>src.offset.rel</td>      <td>imm16</td> <td></td> </tr>

    </tbody>
</table>

